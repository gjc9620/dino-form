import _objectSpread from "@babel/runtime-corejs2/helpers/esm/objectSpread";
import _defineProperty from "@babel/runtime-corejs2/helpers/esm/defineProperty";
import _extends from "@babel/runtime-corejs2/helpers/esm/extends";
import _Object$assign from "@babel/runtime-corejs2/core-js/object/assign";
import _objectWithoutProperties from "@babel/runtime-corejs2/helpers/esm/objectWithoutProperties";
import React, { Component } from 'react';
import { prefix, mapObject, sleep, isExist, isNotExist } from './util';
import DinoFormItem from './DinoFormItem';
import Drag from './Drag';
export async function getRef() {
  let getFun = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : () => {};
  let timeout = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 500;
  let ref = getFun();
  const startTime = +new Date();

  while (1) {
    const now = +new Date();

    if (now - startTime > timeout) {
      console.warn('[dino-form] get ref timeout, maybe you not render it.');
      return undefined;
    }

    await sleep();
    ref = getFun();
    if (ref) break;
  }

  return ref;
}
export const createFragments = (_ref) => {
  let fragments = _ref.fragments,
      createDinoFormApi = _ref.createDinoFormApi;
  return mapObject(fragments, function (comName) {
    let _ref2 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
        Com = _ref2.Com,
        props = _objectWithoutProperties(_ref2, ["Com"]);

    return {
      [comName]: _Object$assign(class Fragment extends Component {
        render() {
          return React.createElement(Com, _extends({
            dinoForm: createDinoFormApi()
          }, props, this.props || {}));
        }

      }, props)
    };
  });
};
export const createFromItem = (_ref3) => {
  let createDinoFormApi = _ref3.createDinoFormApi;
  return class DinoFormItemWrap extends Component {
    render() {
      return React.createElement(DinoFormItem, _extends({
        dinoForm: createDinoFormApi()
      }, this.props || {}));
    }

  };
};
export const createDinoFormGroupWrap = (_ref4) => {
  var _temp;

  let setIDRefMap = _ref4.setIDRefMap,
      Com = _ref4.Com,
      topFormRender = _ref4.topFormRender;
  return _temp = class DinoFormWrap extends Component {
    constructor(props) {
      super(props);

      _defineProperty(this, "checkID", () => {
        const _this$props = this.props,
              ID = _this$props.ID,
              index = _this$props.index;

        if (isNotExist(ID)) {
          console.error('[dino-form] props ID not found, look like you forget give a ID in map function.');
        }
      });

      _defineProperty(this, "catchRef", ref => {
        const _this$props2 = this.props,
              ID = _this$props2.ID,
              _this$props2$catchRef = _this$props2.catchRef,
              catchRef = _this$props2$catchRef === void 0 ? () => {} : _this$props2$catchRef;
        this.Com = ref;
        catchRef(ref);
      });

      this.Com = undefined;
    }

    componentDidMount() {
      const _this$props3 = this.props,
            ID = _this$props3.ID,
            index = _this$props3.index;
      this.checkID();
      setIDRefMap(ID, {
        ref: this.Com
      });
    }

    componentWillUnmount() {
      const _this$props4 = this.props,
            ID = _this$props4.ID,
            index = _this$props4.index;
      this.checkID();
      setIDRefMap(ID, {
        ref: undefined
      });
    }

    render() {
      const _this$props5 = this.props,
            ID = _this$props5.ID,
            index = _this$props5.index;
      return React.createElement(Com, {
        ID: ID,
        index: index,
        ref: this.catchRef,
        topFormRender: topFormRender,
        subGroupForm: true
      });
    }

  }, _temp;
};
export const createDinoFormSubForm = function createDinoFormSubForm() {
  let _ref5 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
      subForms = _ref5.subForms,
      topFormRender = _ref5.topFormRender;

  return mapObject(subForms, (formName, form) => {
    const Form = form.Form,
          field = form.field,
          _form$formProps = form.formProps,
          formProps = _form$formProps === void 0 ? {} : _form$formProps;
    const subForm = {
      field,
      formProps,
      ref: undefined,
      Form: class DinoSubForm extends Component {
        render() {
          return React.createElement(Form, _extends({}, formProps, this.props, {
            topFormRender: topFormRender,
            ref: _ref6 => {
              subForm.ref = _ref6;
            }
          }));
        }

      }
    };
    return {
      [formName]: subForm
    };
  });
};
export const dinoFormAddItem = (_ref7) => {
  let getGroup = _ref7.getGroup,
      setID = _ref7.setID,
      getID = _ref7.getID,
      render = _ref7.render;
  const ID = getID();
  getGroup().IDList.push(ID);
  setID(ID + 1);
  render();
  return ID;
};
export const dinoFormDeleteItem = (_ref8) => {
  let deleteID = _ref8.ID,
      getGroup = _ref8.getGroup,
      render = _ref8.render;
  const group = getGroup();
  group.IDList = group.IDList.filter(ID => ID !== deleteID);
  render();
};
export const dinoFormMoveItem = (_ref9) => {
  let ID = _ref9.ID,
      offset = _ref9.offset,
      getGroup = _ref9.getGroup,
      render = _ref9.render;
  const group = getGroup();
  const index = group.IDList.indexOf(ID);
  group.lastActionMoveID = ID;

  if (offset === -Infinity) {
    group.lastMoveID = group.IDList[0];
    group.IDList.splice(index, 1);
    group.IDList.splice(0, 0, ID);
  } else if (offset === Infinity) {
    group.lastMoveID = group.IDList[group.IDList.length - 1];
    group.IDList.splice(index, 1);
    group.IDList.splice(group.IDList.length, 0, ID);
  } else {
    group.lastMoveID = group.IDList[index + offset];
    group.IDList.splice(index, 1);
    group.IDList.splice(index + offset, 0, ID);
  }

  render();
};
export const dinoFormMapGroup = (_ref10) => {
  let _ref10$Form = _ref10.Form,
      FormCom = _ref10$Form.FormCom,
      formProps = _ref10$Form.formProps,
      ID = _ref10.ID,
      IDList = _ref10.IDList,
      index = _ref10.index,
      deleteIt = _ref10.deleteIt,
      moveIt = _ref10.moveIt;
  return [React.createElement(FormCom, _extends({}, formProps, {
    key: ID
  })), React.createElement("div", {
    className: prefix('group-actions'),
    key: "group-actions"
  }, React.createElement("div", {
    className: prefix('group-action-delete'),
    onClick: deleteIt
  }), index !== 0 && React.createElement("div", {
    className: prefix('group-action-move-up'),
    onClick: () => moveIt(-1)
  }), index !== IDList.length - 1 && React.createElement("div", {
    className: prefix('group-action-move-down'),
    onClick: () => moveIt(1)
  }), index !== 0 && React.createElement("div", {
    className: prefix('group-action-move-to-first'),
    onClick: () => moveIt(-Infinity)
  }), index !== IDList.length - 1 && React.createElement("div", {
    className: prefix('group-action-move-to-last'),
    onClick: () => moveIt(Infinity)
  }))];
};
export const groupsAPI = (_ref11) => {
  let groups = _ref11.groups,
      render = _ref11.render,
      setID = _ref11.setID,
      getID = _ref11.getID;
  return mapObject(groups, (formName, groupValue) => {
    const Com = groupValue.Com,
          field = groupValue.field,
          needDrag = groupValue.needDrag,
          clearMotions = groupValue.clearMotions,
          pressedMotions = groupValue.pressedMotions,
          notPressedMotions = groupValue.notPressedMotions,
          createStyle = groupValue.createStyle,
          IDRefMap = groupValue.IDRefMap,
          IDList = groupValue.IDList,
          Form = groupValue.Form,
          _groupValue$formProps = groupValue.formProps,
          formProps = _groupValue$formProps === void 0 ? {} : _groupValue$formProps;

    const addItem = function addItem() {
      let add = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : dinoFormAddItem;
      return add({
        getGroup: () => groupValue,
        setID,
        getID,
        render
      });
    };

    const deleteItem = function deleteItem(ID) {
      let deleteItemFun = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : dinoFormDeleteItem;
      return deleteItemFun({
        ID,
        getGroup: () => groupValue,
        setID,
        getID,
        render
      });
    };

    const moveItem = function moveItem(ID, offset) {
      let move = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : dinoFormMoveItem;
      return move({
        ID,
        offset,
        getGroup: () => groupValue,
        setID,
        getID,
        render
      });
    };

    const doAction = fun => fun({
      getGroup: () => groupValue,
      setID,
      getID,
      render
    });

    const mapFun = (mapGroup, ID, index) => mapGroup({
      ID,
      index: +index,
      Com,
      field,
      IDRefMap,
      IDList,
      Form: {
        FormCom: Form,
        formProps: _objectSpread({}, formProps, (groups[formName].IDRefMap[ID] || {}).props || {}, {
          ID
        })
      },
      deleteIt: () => deleteItem(ID),
      moveIt: offset => moveItem(ID, offset),
      formProps
    });

    const group = {
      IDList,
      dragMap: function dragMap() {
        let mapGroup = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : dinoFormMapGroup;
        return IDList.length > 0 // todo style config
        ? React.createElement(Drag, {
          order: [...IDList],
          lastActionMoveID: groupValue.lastActionMoveID,
          lastMoveID: groupValue.lastMoveID,
          clearMotions: clearMotions,
          pressedMotions: pressedMotions,
          notPressedMotions: notPressedMotions,
          createStyle: createStyle,
          changeDone: newIDList => {
            groupValue.IDList = [...newIDList];
            render();
          }
        }, mapObject(IDList, (index, ID) => ({
          [ID]: mapFun(mapGroup, ID, index)
        }))) : null;
      },
      map: function map() {
        let mapGroup = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : dinoFormMapGroup;
        return IDList.length > 0 ? React.createElement("div", {
          className: `${prefix('map-container')}`
        }, IDList.map((ID, index) => React.createElement("div", {
          className: `${prefix('group-item-wrap')}`,
          key: ID
        }, mapFun(mapGroup, ID, index)))) : null;
      },
      render: function render() {
        let renderGroup = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : ele => React.createElement("div", {
          className: `${prefix('group')}`
        }, React.createElement("div", {
          className: `${prefix('group-ele')}`
        }, ele), React.createElement("div", {
          className: prefix('group-action-add'),
          onClick: () => addItem()
        }));
        let children = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : needDrag ? group.dragMap() : group.map();
        return React.createElement("div", {
          className: `${prefix('group-wrap')}`
        }, renderGroup(children));
      },
      addItem,
      deleteItem,
      moveItem,
      doAction
    };
    return {
      [formName]: group
    };
  });
};
export const subFormsAPI = function subFormsAPI() {
  let _ref12 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
      subForms = _ref12.subForms;

  return mapObject(subForms, (formName, _ref13) => {
    let Form = _ref13.Form;
    return {
      [formName]: Form
    };
  });
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9EaW5vRm9ybUhlbHBlci5qc3giXSwibmFtZXMiOlsiUmVhY3QiLCJDb21wb25lbnQiLCJwcmVmaXgiLCJtYXBPYmplY3QiLCJzbGVlcCIsImlzRXhpc3QiLCJpc05vdEV4aXN0IiwiRGlub0Zvcm1JdGVtIiwiRHJhZyIsImdldFJlZiIsImdldEZ1biIsInRpbWVvdXQiLCJyZWYiLCJzdGFydFRpbWUiLCJEYXRlIiwibm93IiwiY29uc29sZSIsIndhcm4iLCJ1bmRlZmluZWQiLCJjcmVhdGVGcmFnbWVudHMiLCJmcmFnbWVudHMiLCJjcmVhdGVEaW5vRm9ybUFwaSIsImNvbU5hbWUiLCJDb20iLCJwcm9wcyIsIkZyYWdtZW50IiwicmVuZGVyIiwiY3JlYXRlRnJvbUl0ZW0iLCJEaW5vRm9ybUl0ZW1XcmFwIiwiY3JlYXRlRGlub0Zvcm1Hcm91cFdyYXAiLCJzZXRJRFJlZk1hcCIsInRvcEZvcm1SZW5kZXIiLCJEaW5vRm9ybVdyYXAiLCJjb25zdHJ1Y3RvciIsIklEIiwiaW5kZXgiLCJlcnJvciIsImNhdGNoUmVmIiwiY29tcG9uZW50RGlkTW91bnQiLCJjaGVja0lEIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJjcmVhdGVEaW5vRm9ybVN1YkZvcm0iLCJzdWJGb3JtcyIsImZvcm1OYW1lIiwiZm9ybSIsIkZvcm0iLCJmaWVsZCIsImZvcm1Qcm9wcyIsInN1YkZvcm0iLCJEaW5vU3ViRm9ybSIsImRpbm9Gb3JtQWRkSXRlbSIsImdldEdyb3VwIiwic2V0SUQiLCJnZXRJRCIsIklETGlzdCIsInB1c2giLCJkaW5vRm9ybURlbGV0ZUl0ZW0iLCJkZWxldGVJRCIsImdyb3VwIiwiZmlsdGVyIiwiZGlub0Zvcm1Nb3ZlSXRlbSIsIm9mZnNldCIsImluZGV4T2YiLCJsYXN0QWN0aW9uTW92ZUlEIiwiSW5maW5pdHkiLCJsYXN0TW92ZUlEIiwic3BsaWNlIiwibGVuZ3RoIiwiZGlub0Zvcm1NYXBHcm91cCIsIkZvcm1Db20iLCJkZWxldGVJdCIsIm1vdmVJdCIsImdyb3Vwc0FQSSIsImdyb3VwcyIsImdyb3VwVmFsdWUiLCJuZWVkRHJhZyIsImNsZWFyTW90aW9ucyIsInByZXNzZWRNb3Rpb25zIiwibm90UHJlc3NlZE1vdGlvbnMiLCJjcmVhdGVTdHlsZSIsIklEUmVmTWFwIiwiYWRkSXRlbSIsImFkZCIsImRlbGV0ZUl0ZW0iLCJkZWxldGVJdGVtRnVuIiwibW92ZUl0ZW0iLCJtb3ZlIiwiZG9BY3Rpb24iLCJmdW4iLCJtYXBGdW4iLCJtYXBHcm91cCIsImRyYWdNYXAiLCJuZXdJRExpc3QiLCJtYXAiLCJyZW5kZXJHcm91cCIsImVsZSIsImNoaWxkcmVuIiwic3ViRm9ybXNBUEkiXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBT0EsS0FBUCxJQUFnQkMsU0FBaEIsUUFBaUMsT0FBakM7QUFDQSxTQUNFQyxNQURGLEVBQ1VDLFNBRFYsRUFDcUJDLEtBRHJCLEVBQzRCQyxPQUQ1QixFQUNxQ0MsVUFEckMsUUFFTyxRQUZQO0FBR0EsT0FBT0MsWUFBUCxNQUF5QixnQkFBekI7QUFDQSxPQUFPQyxJQUFQLE1BQWlCLFFBQWpCO0FBRUEsT0FBTyxlQUFlQyxNQUFmLEdBR0w7QUFBQSxNQUZBQyxNQUVBLHVFQUZTLE1BQU0sQ0FBRSxDQUVqQjtBQUFBLE1BREFDLE9BQ0EsdUVBRFUsR0FDVjtBQUNBLE1BQUlDLEdBQUcsR0FBR0YsTUFBTSxFQUFoQjtBQUVBLFFBQU1HLFNBQVMsR0FBRyxDQUFDLElBQUlDLElBQUosRUFBbkI7O0FBRUEsU0FBTyxDQUFQLEVBQVU7QUFDUixVQUFNQyxHQUFHLEdBQUcsQ0FBQyxJQUFJRCxJQUFKLEVBQWI7O0FBQ0EsUUFBSUMsR0FBRyxHQUFHRixTQUFOLEdBQWtCRixPQUF0QixFQUErQjtBQUM3QkssTUFBQUEsT0FBTyxDQUFDQyxJQUFSLENBQWEsdURBQWI7QUFDQSxhQUFPQyxTQUFQO0FBQ0Q7O0FBQ0QsVUFBTWQsS0FBSyxFQUFYO0FBRUFRLElBQUFBLEdBQUcsR0FBR0YsTUFBTSxFQUFaO0FBRUEsUUFBSUUsR0FB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QSxNQUFNLENBQUMsV0FBRCxDQUFjO0FBQXhDLFdBQ0c2RixHQURILENBREYsRUFJRTtBQUNFLFVBQUEsU0FBUyxFQUFHN0YsTUFBTSxDQUFDLGtCQUFELENBRHBCO0FBRUUsVUFBQSxPQUFPLEVBQUcsTUFBTStFLE9BQU87QUFGekIsVUFKRixDQUZJO0FBQUEsWUFhTmUsUUFiTSx1RUFhTXJCLFFBQVEsR0FBR2pCLEtBQUssQ0FBQ2lDLE9BQU4sRUFBSCxHQUFxQmpDLEtBQUssQ0FBQ21DLEdBQU4sRUFibkM7QUFBQSxlQWVOO0FBQUssVUFBQSxTQUFTLEVBQUksR0FBRTNGLE1BQU0sQ0FBQyxZQUFELENBQWU7QUFBekMsV0FDRzRGLFdBQVcsQ0FBQ0UsUUFBRCxDQURkLENBZk07QUFBQSxPQXBDSTtBQXVEWmYsTUFBQUEsT0F2RFk7QUF3RFpFLE1BQUFBLFVBeERZO0FBeURaRSxNQUFBQSxRQXpEWTtBQTBEWkUsTUFBQUE7QUExRFksS0FBZDtBQTZEQSxXQUFPO0FBQUUsT0FBQzVDLFFBQUQsR0FBWWU7QUFBZCxLQUFQO0FBQ0QsR0EzSWMsQ0FMVTtBQUFBLENBQWxCO0FBa0pQLE9BQU8sTUFBTXVDLFdBQVcsR0FBRyxTQUFkQSxXQUFjO0FBQUEsbUZBQWdCLEVBQWhCO0FBQUEsTUFBR3ZELFFBQUgsVUFBR0EsUUFBSDs7QUFBQSxTQUF1QnZDLFNBQVMsQ0FBQ3VDLFFBQUQsRUFBVyxDQUFDQyxRQUFEO0FBQUEsUUFBYUUsSUFBYixVQUFhQSxJQUFiO0FBQUEsV0FBeUI7QUFDN0YsT0FBQ0YsUUFBRCxHQUFZRTtBQURpRixLQUF6QjtBQUFBLEdBQVgsQ0FBaEM7QUFBQSxDQUFwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQge1xuICBwcmVmaXgsIG1hcE9iamVjdCwgc2xlZXAsIGlzRXhpc3QsIGlzTm90RXhpc3QsXG59IGZyb20gJy4vdXRpbCc7XG5pbXBvcnQgRGlub0Zvcm1JdGVtIGZyb20gJy4vRGlub0Zvcm1JdGVtJztcbmltcG9ydCBEcmFnIGZyb20gJy4vRHJhZyc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRSZWYoXG4gIGdldEZ1biA9ICgpID0+IHt9LFxuICB0aW1lb3V0ID0gNTAwLFxuKSB7XG4gIGxldCByZWYgPSBnZXRGdW4oKTtcblxuICBjb25zdCBzdGFydFRpbWUgPSArbmV3IERhdGUoKTtcblxuICB3aGlsZSAoMSkge1xuICAgIGNvbnN0IG5vdyA9ICtuZXcgRGF0ZSgpO1xuICAgIGlmIChub3cgLSBzdGFydFRpbWUgPiB0aW1lb3V0KSB7XG4gICAgICBjb25zb2xlLndhcm4oJ1tkaW5vLWZvcm1dIGdldCByZWYgdGltZW91dCwgbWF5YmUgeW91IG5vdCByZW5kZXIgaXQuJyk7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBhd2FpdCBzbGVlcCgpO1xuXG4gICAgcmVmID0gZ2V0RnVuKCk7XG5cbiAgICBpZiAocmVmKSBicmVhaztcbiAgfVxuXG4gIHJldHVybiByZWY7XG59XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVGcmFnbWVudHMgPSAoeyBmcmFnbWVudHMsIGNyZWF0ZURpbm9Gb3JtQXBpIH0pID0+IChcbiAgbWFwT2JqZWN0KGZyYWdtZW50cywgKGNvbU5hbWUsIHsgQ29tLCAuLi5wcm9wcyB9ID0ge30pID0+ICh7XG4gICAgW2NvbU5hbWVdOiBPYmplY3QuYXNzaWduKFxuICAgICAgY2xhc3MgRnJhZ21lbnQgZXh0ZW5kcyBDb21wb25lbnQge1xuICAgICAgICByZW5kZXIoKSB7XG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxDb21cbiAgICAgICAgICAgICAgZGlub0Zvcm09eyBjcmVhdGVEaW5vRm9ybUFwaSgpIH1cbiAgICAgICAgICAgICAgeyAuLi5wcm9wcyB9XG4gICAgICAgICAgICAgIHsgLi4uKHRoaXMucHJvcHMgfHwge30pIH1cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcHJvcHMsXG4gICAgKSxcbiAgfSkpXG4pO1xuXG5leHBvcnQgY29uc3QgY3JlYXRlRnJvbUl0ZW0gPSAoeyBjcmVhdGVEaW5vRm9ybUFwaSB9KSA9PiAoXG4gIGNsYXNzIERpbm9Gb3JtSXRlbVdyYXAgZXh0ZW5kcyBDb21wb25lbnQge1xuICAgIHJlbmRlcigpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxEaW5vRm9ybUl0ZW1cbiAgICAgICAgICBkaW5vRm9ybT17IGNyZWF0ZURpbm9Gb3JtQXBpKCkgfVxuICAgICAgICAgIHsgLi4uKHRoaXMucHJvcHMgfHwge30pIH1cbiAgICAgICAgICAvPlxuICAgICAgKTtcbiAgICB9XG4gIH1cbik7XG5cblxuZXhwb3J0IGNvbnN0IGNyZWF0ZURpbm9Gb3JtR3JvdXBXcmFwID0gKHtcbiAgc2V0SURSZWZNYXAsIENvbSwgdG9wRm9ybVJlbmRlcixcbn0pID0+IChcbiAgY2xhc3MgRGlub0Zvcm1XcmFwIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgdGhpcy5Db20gPSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgY2hlY2tJRCA9ICgpID0+IHtcbiAgICAgIGNvbnN0IHsgSUQsIGluZGV4IH0gPSB0aGlzLnByb3BzO1xuICAgICAgaWYgKGlzTm90RXhpc3QoSUQpKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tkaW5vLWZvcm1dIHByb3BzIElEIG5vdCBmb3VuZCwgbG9vayBsaWtlIHlvdSBmb3JnZXQgZ2l2ZSBhIElEIGluIG1hcCBmdW5jdGlvbi4nKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgIGNvbnN0IHsgSUQsIGluZGV4IH0gPSB0aGlzLnByb3BzO1xuICAgICAgdGhpcy5jaGVja0lEKCk7XG4gICAgICBzZXRJRFJlZk1hcChJRCwgeyByZWY6IHRoaXMuQ29tIH0pO1xuICAgIH1cblxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgY29uc3QgeyBJRCwgaW5kZXggfSA9IHRoaXMucHJvcHM7XG4gICAgICB0aGlzLmNoZWNrSUQoKTtcbiAgICAgIHNldElEUmVmTWFwKElELCB7IHJlZjogdW5kZWZpbmVkIH0pO1xuICAgIH1cblxuICAgIGNhdGNoUmVmID0gKHJlZikgPT4ge1xuICAgICAgY29uc3QgeyBJRCwgY2F0Y2hSZWYgPSAoKSA9PiB7fSB9ID0gdGhpcy5wcm9wcztcbiAgICAgIHRoaXMuQ29tID0gcmVmO1xuICAgICAgY2F0Y2hSZWYocmVmKTtcbiAgICB9XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICBjb25zdCB7IElELCBpbmRleCB9ID0gdGhpcy5wcm9wcztcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxDb21cbiAgICAgICAgICBJRD17IElEIH1cbiAgICAgICAgICBpbmRleD17IGluZGV4IH1cbiAgICAgICAgICByZWY9eyB0aGlzLmNhdGNoUmVmIH1cbiAgICAgICAgICB0b3BGb3JtUmVuZGVyPXsgdG9wRm9ybVJlbmRlciB9XG4gICAgICAgICAgc3ViR3JvdXBGb3JtXG4gICAgICAgICAgLz5cbiAgICAgICk7XG4gICAgfVxuICB9XG4pO1xuXG5leHBvcnQgY29uc3QgY3JlYXRlRGlub0Zvcm1TdWJGb3JtID0gKHsgc3ViRm9ybXMsIHRvcEZvcm1SZW5kZXIgfSA9IHt9KSA9PiAoXG4gIG1hcE9iamVjdChzdWJGb3JtcywgKGZvcm1OYW1lLCBmb3JtKSA9PiB7XG4gICAgY29uc3QgeyBGb3JtLCBmaWVsZCwgZm9ybVByb3BzID0ge30gfSA9IGZvcm07XG4gICAgY29uc3Qgc3ViRm9ybSA9IHtcbiAgICAgIGZpZWxkLFxuICAgICAgZm9ybVByb3BzLFxuICAgICAgcmVmOiB1bmRlZmluZWQsXG4gICAgICBGb3JtOiBjbGFzcyBEaW5vU3ViRm9ybSBleHRlbmRzIENvbXBvbmVudCB7XG4gICAgICAgIHJlbmRlcigpIHtcbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPEZvcm1cbiAgICAgICAgICAgICAgeyAuLi5mb3JtUHJvcHMgfVxuICAgICAgICAgICAgICB7IC4uLnRoaXMucHJvcHMgfVxuICAgICAgICAgICAgICB0b3BGb3JtUmVuZGVyPXsgdG9wRm9ybVJlbmRlciB9XG4gICAgICAgICAgICAgIHJlZj17IChyZWYpID0+IHsgc3ViRm9ybS5yZWYgPSByZWY7IH0gfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfTtcbiAgICByZXR1cm4ge1xuICAgICAgW2Zvcm1OYW1lXTogc3ViRm9ybSxcbiAgICB9O1xuICB9KVxuKTtcblxuXG5leHBvcnQgY29uc3QgZGlub0Zvcm1BZGRJdGVtID0gKHtcbiAgZ2V0R3JvdXAsXG4gIHNldElELFxuICBnZXRJRCxcbiAgcmVuZGVyLFxufSkgPT4ge1xuICBjb25zdCBJRCA9IGdldElEKCk7XG4gIGdldEdyb3VwKCkuSURMaXN0LnB1c2goSUQpO1xuICBzZXRJRChJRCArIDEpO1xuICByZW5kZXIoKTtcbiAgcmV0dXJuIElEO1xufTtcblxuZXhwb3J0IGNvbnN0IGRpbm9Gb3JtRGVsZXRlSXRlbSA9ICh7IElEOiBkZWxldGVJRCwgZ2V0R3JvdXAsIHJlbmRlciB9KSA9PiB7XG4gIGNvbnN0IGdyb3VwID0gZ2V0R3JvdXAoKTtcbiAgZ3JvdXAuSURMaXN0ID0gZ3JvdXAuSURMaXN0LmZpbHRlcihJRCA9PiBJRCAhPT0gZGVsZXRlSUQpO1xuICByZW5kZXIoKTtcbn07XG5cbmV4cG9ydCBjb25zdCBkaW5vRm9ybU1vdmVJdGVtID0gKHtcbiAgSUQsIG9mZnNldCwgZ2V0R3JvdXAsIHJlbmRlcixcbn0pID0+IHtcbiAgY29uc3QgZ3JvdXAgPSBnZXRHcm91cCgpO1xuICBjb25zdCBpbmRleCA9IGdyb3VwLklETGlzdC5pbmRleE9mKElEKTtcbiAgZ3JvdXAubGFzdEFjdGlvbk1vdmVJRCA9IElEO1xuXG4gIGlmIChvZmZzZXQgPT09IC1JbmZpbml0eSkge1xuICAgIGdyb3VwLmxhc3RNb3ZlSUQgPSBncm91cC5JRExpc3RbMF07XG4gICAgZ3JvdXAuSURMaXN0LnNwbGljZShpbmRleCwgMSk7XG4gICAgZ3JvdXAuSURMaXN0LnNwbGljZSgwLCAwLCBJRCk7XG4gIH0gZWxzZSBpZiAob2Zmc2V0ID09PSBJbmZpbml0eSkge1xuICAgIGdyb3VwLmxhc3RNb3ZlSUQgPSBncm91cC5JRExpc3RbZ3JvdXAuSURMaXN0Lmxlbmd0aCAtIDFdO1xuICAgIGdyb3VwLklETGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIGdyb3VwLklETGlzdC5zcGxpY2UoZ3JvdXAuSURMaXN0Lmxlbmd0aCwgMCwgSUQpO1xuICB9IGVsc2Uge1xuICAgIGdyb3VwLmxhc3RNb3ZlSUQgPSBncm91cC5JRExpc3RbaW5kZXggKyBvZmZzZXRdO1xuICAgIGdyb3VwLklETGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIGdyb3VwLklETGlzdC5zcGxpY2UoaW5kZXggKyBvZmZzZXQsIDAsIElEKTtcbiAgfVxuXG4gIHJlbmRlcigpO1xufTtcblxuXG5leHBvcnQgY29uc3QgZGlub0Zvcm1NYXBHcm91cCA9ICh7XG4gIEZvcm06IHtcbiAgICBGb3JtQ29tLFxuICAgIGZvcm1Qcm9wcyxcbiAgfSxcbiAgSUQsXG4gIElETGlzdCxcbiAgaW5kZXgsXG4gIGRlbGV0ZUl0LFxuICBtb3ZlSXQsXG59KSA9PiAoW1xuICA8Rm9ybUNvbSB7IC4uLmZvcm1Qcm9wcyB9IGtleT17IElEIH0gLz4sXG4gIDxkaXYgY2xhc3NOYW1lPXsgcHJlZml4KCdncm91cC1hY3Rpb25zJykgfSBrZXk9XCJncm91cC1hY3Rpb25zXCI+XG4gICAgPGRpdiBjbGFzc05hbWU9eyBwcmVmaXgoJ2dyb3VwLWFjdGlvbi1kZWxldGUnKSB9IG9uQ2xpY2s9eyBkZWxldGVJdCB9IC8+XG4gICAge1xuICAgICAgaW5kZXggIT09IDBcbiAgICAgICYmIChcbiAgICAgICAgPGRpdlxuICAgICAgICAgIGNsYXNzTmFtZT17IHByZWZpeCgnZ3JvdXAtYWN0aW9uLW1vdmUtdXAnKSB9XG4gICAgICAgICAgb25DbGljaz17ICgpID0+IG1vdmVJdCgtMSkgfVxuICAgICAgICAgIC8+XG4gICAgICApXG4gICAgfVxuICAgIHtcbiAgICAgIGluZGV4ICE9PSBJRExpc3QubGVuZ3RoIC0gMVxuICAgICAgJiYgKFxuICAgICAgICA8ZGl2XG4gICAgICAgICAgY2xhc3NOYW1lPXsgcHJlZml4KCdncm91cC1hY3Rpb24tbW92ZS1kb3duJykgfVxuICAgICAgICAgIG9uQ2xpY2s9eyAoKSA9PiBtb3ZlSXQoMSkgfVxuICAgICAgICAgIC8+XG4gICAgICApXG4gICAgfVxuICAgIHtcbiAgICAgIGluZGV4ICE9PSAwXG4gICAgICAmJiAoXG4gICAgICAgIDxkaXZcbiAgICAgICAgICBjbGFzc05hbWU9eyBwcmVmaXgoJ2dyb3VwLWFjdGlvbi1tb3ZlLXRvLWZpcnN0JykgfVxuICAgICAgICAgIG9uQ2xpY2s9eyAoKSA9PiBtb3ZlSXQoLUluZmluaXR5KSB9XG4gICAgICAgICAgLz5cbiAgICAgIClcbiAgICB9XG4gICAge1xuICAgICAgaW5kZXggIT09IElETGlzdC5sZW5ndGggLSAxXG4gICAgICAmJiAoXG4gICAgICAgIDxkaXZcbiAgICAgICAgICBjbGFzc05hbWU9eyBwcmVmaXgoJ2dyb3VwLWFjdGlvbi1tb3ZlLXRvLWxhc3QnKSB9XG4gICAgICAgICAgb25DbGljaz17ICgpID0+IG1vdmVJdChJbmZpbml0eSkgfVxuICAgICAgICAgIC8+XG4gICAgICApXG4gICAgfVxuICA8L2Rpdj4sXG5dKTtcblxuZXhwb3J0IGNvbnN0IGdyb3Vwc0FQSSA9ICh7XG4gIGdyb3VwcyxcbiAgcmVuZGVyLFxuICBzZXRJRCxcbiAgZ2V0SUQsXG59KSA9PiBtYXBPYmplY3QoZ3JvdXBzLCAoZm9ybU5hbWUsIGdyb3VwVmFsdWUpID0+IHtcbiAgY29uc3Qge1xuICAgIENvbSxcbiAgICBmaWVsZCxcbiAgICBuZWVkRHJhZyxcbiAgICBjbGVhck1vdGlvbnMsXG4gICAgcHJlc3NlZE1vdGlvbnMsXG4gICAgbm90UHJlc3NlZE1vdGlvbnMsXG4gICAgY3JlYXRlU3R5bGUsXG4gICAgSURSZWZNYXAsXG4gICAgSURMaXN0LFxuICAgIEZvcm0sXG4gICAgZm9ybVByb3BzID0ge30sXG4gIH0gPSBncm91cFZhbHVlO1xuXG4gIGNvbnN0IGFkZEl0ZW0gPSAoXG4gICAgYWRkID0gZGlub0Zvcm1BZGRJdGVtLFxuICApID0+IGFkZCh7XG4gICAgZ2V0R3JvdXA6ICgpID0+IGdyb3VwVmFsdWUsXG4gICAgc2V0SUQsXG4gICAgZ2V0SUQsXG4gICAgcmVuZGVyLFxuICB9KTtcblxuICBjb25zdCBkZWxldGVJdGVtID0gKFxuICAgIElELFxuICAgIGRlbGV0ZUl0ZW1GdW4gPSBkaW5vRm9ybURlbGV0ZUl0ZW0sXG4gICkgPT4gZGVsZXRlSXRlbUZ1bih7XG4gICAgSUQsXG4gICAgZ2V0R3JvdXA6ICgpID0+IGdyb3VwVmFsdWUsXG4gICAgc2V0SUQsXG4gICAgZ2V0SUQsXG4gICAgcmVuZGVyLFxuICB9KTtcblxuICBjb25zdCBtb3ZlSXRlbSA9IChcbiAgICBJRCxcbiAgICBvZmZzZXQsXG4gICAgbW92ZSA9IGRpbm9Gb3JtTW92ZUl0ZW0sXG4gICkgPT4gbW92ZSh7XG4gICAgSUQsXG4gICAgb2Zmc2V0LFxuICAgIGdldEdyb3VwOiAoKSA9PiBncm91cFZhbHVlLFxuICAgIHNldElELFxuICAgIGdldElELFxuICAgIHJlbmRlcixcbiAgfSk7XG5cbiAgY29uc3QgZG9BY3Rpb24gPSBmdW4gPT4gZnVuKHtcbiAgICBnZXRHcm91cDogKCkgPT4gZ3JvdXBWYWx1ZSxcbiAgICBzZXRJRCxcbiAgICBnZXRJRCxcbiAgICByZW5kZXIsXG4gIH0pO1xuXG4gIGNvbnN0IG1hcEZ1biA9IChtYXBHcm91cCwgSUQsIGluZGV4KSA9PiAoXG4gICAgbWFwR3JvdXAoe1xuICAgICAgSUQsXG4gICAgICBpbmRleDogK2luZGV4LFxuICAgICAgQ29tLFxuICAgICAgZmllbGQsXG4gICAgICBJRFJlZk1hcCxcbiAgICAgIElETGlzdCxcbiAgICAgIEZvcm06IHtcbiAgICAgICAgRm9ybUNvbTogRm9ybSxcbiAgICAgICAgZm9ybVByb3BzOiB7XG4gICAgICAgICAgLi4uZm9ybVByb3BzLFxuICAgICAgICAgIC4uLigoZ3JvdXBzW2Zvcm1OYW1lXS5JRFJlZk1hcFtJRF0gfHwge30pLnByb3BzIHx8IHt9KSxcbiAgICAgICAgICBJRCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBkZWxldGVJdDogKCkgPT4gZGVsZXRlSXRlbShJRCksXG4gICAgICBtb3ZlSXQ6IG9mZnNldCA9PiBtb3ZlSXRlbShJRCwgb2Zmc2V0KSxcbiAgICAgIGZvcm1Qcm9wcyxcbiAgICB9KVxuICApO1xuXG4gIGNvbnN0IGdyb3VwID0ge1xuICAgIElETGlzdCxcbiAgICBkcmFnTWFwOiAobWFwR3JvdXAgPSBkaW5vRm9ybU1hcEdyb3VwKSA9PiAoXG4gICAgICBJRExpc3QubGVuZ3RoID4gMCAvLyB0b2RvIHN0eWxlIGNvbmZpZ1xuICAgICAgICA/IChcbiAgICAgICAgICA8RHJhZ1xuICAgICAgICAgICAgb3JkZXI9eyBbLi4uSURMaXN0XSB9XG4gICAgICAgICAgICBsYXN0QWN0aW9uTW92ZUlEPXsgZ3JvdXBWYWx1ZS5sYXN0QWN0aW9uTW92ZUlEIH1cbiAgICAgICAgICAgIGxhc3RNb3ZlSUQ9eyBncm91cFZhbHVlLmxhc3RNb3ZlSUQgfVxuICAgICAgICAgICAgY2xlYXJNb3Rpb25zPXsgY2xlYXJNb3Rpb25zIH1cbiAgICAgICAgICAgIHByZXNzZWRNb3Rpb25zPXsgcHJlc3NlZE1vdGlvbnMgfVxuICAgICAgICAgICAgbm90UHJlc3NlZE1vdGlvbnM9eyBub3RQcmVzc2VkTW90aW9ucyB9XG4gICAgICAgICAgICBjcmVhdGVTdHlsZT17IGNyZWF0ZVN0eWxlIH1cbiAgICAgICAgICAgIGNoYW5nZURvbmU9eyAobmV3SURMaXN0KSA9PiB7XG4gICAgICAgICAgICAgIGdyb3VwVmFsdWUuSURMaXN0ID0gWy4uLm5ld0lETGlzdF07IHJlbmRlcigpO1xuICAgICAgICAgICAgfSB9PlxuICAgICAgICAgICAge1xuICAgICAgICAgIG1hcE9iamVjdChJRExpc3QsIChpbmRleCwgSUQpID0+ICh7IFtJRF06IG1hcEZ1bihtYXBHcm91cCwgSUQsIGluZGV4KSB9KSlcbiAgICAgICAgfVxuICAgICAgICAgIDwvRHJhZz5cbiAgICAgICAgKSA6IG51bGxcbiAgICApLFxuICAgIG1hcDogKG1hcEdyb3VwID0gZGlub0Zvcm1NYXBHcm91cCkgPT4gKFxuICAgICAgSURMaXN0Lmxlbmd0aCA+IDBcbiAgICAgICAgPyAoXG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9eyBgJHtwcmVmaXgoJ21hcC1jb250YWluZXInKX1gIH0+XG4gICAgICAgICAgICB7XG4gICAgICAgICAgSURMaXN0Lm1hcCgoSUQsIGluZGV4KSA9PiAoXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17IGAke3ByZWZpeCgnZ3JvdXAtaXRlbS13cmFwJyl9YCB9IGtleT17IElEIH0+XG4gICAgICAgICAgICAgIHsgbWFwRnVuKG1hcEdyb3VwLCBJRCwgaW5kZXgpfVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgKSlcbiAgICAgICAgfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApIDogbnVsbFxuICAgICksXG4gICAgcmVuZGVyOiAoXG4gICAgICByZW5kZXJHcm91cCA9IGVsZSA9PiAoXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPXsgYCR7cHJlZml4KCdncm91cCcpfWAgfT5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17IGAke3ByZWZpeCgnZ3JvdXAtZWxlJyl9YCB9PlxuICAgICAgICAgICAge2VsZX1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICBjbGFzc05hbWU9eyBwcmVmaXgoJ2dyb3VwLWFjdGlvbi1hZGQnKSB9XG4gICAgICAgICAgICBvbkNsaWNrPXsgKCkgPT4gYWRkSXRlbSgpIH1cbiAgICAgICAgICAgIC8+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKSxcbiAgICAgIC8vIGNoaWxkcmVuID0gKG5lZWREcmFwID8gZ3JvdXAuZHJhZ01hcCgpIDogZ3JvdXAubWFwKCkpLFxuICAgICAgY2hpbGRyZW4gPSAobmVlZERyYWcgPyBncm91cC5kcmFnTWFwKCkgOiBncm91cC5tYXAoKSksXG4gICAgKSA9PiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT17IGAke3ByZWZpeCgnZ3JvdXAtd3JhcCcpfWAgfT5cbiAgICAgICAge3JlbmRlckdyb3VwKGNoaWxkcmVuKX1cbiAgICAgIDwvZGl2PlxuICAgICksXG4gICAgYWRkSXRlbSxcbiAgICBkZWxldGVJdGVtLFxuICAgIG1vdmVJdGVtLFxuICAgIGRvQWN0aW9uLFxuICB9O1xuXG4gIHJldHVybiB7IFtmb3JtTmFtZV06IGdyb3VwIH07XG59KTtcblxuZXhwb3J0IGNvbnN0IHN1YkZvcm1zQVBJID0gKHsgc3ViRm9ybXMgfSA9IHt9KSA9PiBtYXBPYmplY3Qoc3ViRm9ybXMsIChmb3JtTmFtZSwgeyBGb3JtIH0pID0+ICh7XG4gIFtmb3JtTmFtZV06IEZvcm0sXG59KSk7XG4iXX0=