import _objectSpread from "@babel/runtime-corejs2/helpers/esm/objectSpread";
import _defineProperty from "@babel/runtime-corejs2/helpers/esm/defineProperty";
import _extends from "@babel/runtime-corejs2/helpers/esm/extends";
import _Object$assign from "@babel/runtime-corejs2/core-js/object/assign";
import _objectWithoutProperties from "@babel/runtime-corejs2/helpers/esm/objectWithoutProperties";
import React, { Component } from 'react';
import { prefix, mapObject } from './util';
import DinoFormItem from './DinoFormItem';
import Drag from './Drag';
export const dinoFormGetGroupRef = async function dinoFormGetGroupRef() {
  let _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
      group = _ref.group,
      index = _ref.index,
      ID = _ref.ID,
      render = _ref.render;

  const IDRefMap = group.IDRefMap,
        IDList = group.IDList,
        formName = group.formName;
  let _IDRefMap$ID = IDRefMap[ID];
  _IDRefMap$ID = _IDRefMap$ID === void 0 ? {} : _IDRefMap$ID;
  let ref = _IDRefMap$ID.ref; // const

  let _ = 3,
      reTryRefCount = _.reTryRefCount;

  while (!ref && reTryRefCount-- > 0) {
    await render();
    var _IDRefMap$ID2 = IDRefMap[ID];
    _IDRefMap$ID2 = _IDRefMap$ID2 === void 0 ? {} : _IDRefMap$ID2;
    ref = _IDRefMap$ID2.ref;
  }

  return ref;
};
export const createFragments = (_ref2) => {
  let fragments = _ref2.fragments,
      createDinoFormApi = _ref2.createDinoFormApi;
  return mapObject(fragments, function (comName) {
    let _ref3 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
        Com = _ref3.Com,
        props = _objectWithoutProperties(_ref3, ["Com"]);

    return {
      [comName]: _Object$assign(class Fragment extends Component {
        render() {
          return React.createElement(Com, _extends({
            dinoForm: createDinoFormApi()
          }, props, this.props || {}));
        }

      }, props)
    };
  });
};
export const createFromItem = (_ref4) => {
  let createDinoFormApi = _ref4.createDinoFormApi;
  return class DinoFormItemWrap extends Component {
    render() {
      return React.createElement(DinoFormItem, _extends({
        dinoForm: createDinoFormApi()
      }, this.props || {}));
    }

  };
};
export const createDinoFormGroupWrap = (_ref5) => {
  var _temp;

  let setIDRefMap = _ref5.setIDRefMap,
      Com = _ref5.Com,
      topFormRender = _ref5.topFormRender;
  return _temp = class DinoFormWrap extends Component {
    constructor(props) {
      super(props);

      _defineProperty(this, "catchRef", ref => {
        const _this$props = this.props,
              ID = _this$props.ID,
              _this$props$catchRef = _this$props.catchRef,
              catchRef = _this$props$catchRef === void 0 ? () => {} : _this$props$catchRef;
        this.Com = ref;
        catchRef(ref);
      });

      this.Com = undefined;
    }

    componentDidMount() {
      const _this$props2 = this.props,
            ID = _this$props2.ID,
            index = _this$props2.index;
      setIDRefMap(ID, {
        ref: this.Com
      });
    }

    componentWillUnmount() {
      const _this$props3 = this.props,
            ID = _this$props3.ID,
            index = _this$props3.index;
      setIDRefMap(ID, {
        ref: undefined
      });
    }

    render() {
      const _this$props4 = this.props,
            ID = _this$props4.ID,
            index = _this$props4.index;
      return React.createElement(Com, {
        ID: ID,
        index: index,
        ref: this.catchRef,
        topFormRender: topFormRender,
        subGroupForm: true
      });
    }

  }, _temp;
};
export const createDinoFormSubForm = subForms => mapObject(subForms, (formName, form) => {
  const Form = form.Form,
        field = form.field,
        _form$formProps = form.formProps,
        formProps = _form$formProps === void 0 ? {} : _form$formProps;
  const subForm = {
    field,
    formProps,
    ref: undefined,
    Form: class DinoSubForm extends Component {
      render() {
        return React.createElement(Form, _extends({}, formProps, this.props, {
          ref: _ref6 => {
            subForm.ref = _ref6;
          }
        }));
      }

    }
  };
  return {
    [formName]: subForm
  };
});
export const dinoFormAddItem = (_ref7) => {
  let getGroup = _ref7.getGroup,
      setID = _ref7.setID,
      getID = _ref7.getID,
      render = _ref7.render;
  const ID = getID();
  getGroup().IDList.push(ID);
  setID(ID + 1);
  render();
  return ID;
};
export const dinoFormDeleteItem = (_ref8) => {
  let deleteID = _ref8.ID,
      getGroup = _ref8.getGroup,
      render = _ref8.render;
  const group = getGroup();
  group.IDList = group.IDList.filter(ID => ID !== deleteID);
  render();
};
export const dinoFormMoveItem = (_ref9) => {
  let ID = _ref9.ID,
      offset = _ref9.offset,
      getGroup = _ref9.getGroup,
      render = _ref9.render;
  const group = getGroup();
  const index = group.IDList.indexOf(ID);
  group.lastActionMoveID = ID;

  if (offset === -Infinity) {
    group.lastMoveID = group.IDList[0];
    group.IDList.splice(index, 1);
    group.IDList.splice(0, 0, ID);
  } else if (offset === Infinity) {
    group.lastMoveID = group.IDList[group.IDList.length - 1];
    group.IDList.splice(index, 1);
    group.IDList.splice(group.IDList.length, 0, ID);
  } else {
    group.lastMoveID = group.IDList[index + offset];
    group.IDList.splice(index, 1);
    group.IDList.splice(index + offset, 0, ID);
  }

  render();
};
export const dinoFormMapGroup = (_ref10) => {
  let _ref10$Form = _ref10.Form,
      FormCom = _ref10$Form.FormCom,
      formProps = _ref10$Form.formProps,
      ID = _ref10.ID,
      IDList = _ref10.IDList,
      index = _ref10.index,
      deleteIt = _ref10.deleteIt,
      moveIt = _ref10.moveIt;
  return [React.createElement(FormCom, _extends({}, formProps, {
    key: ID
  })), React.createElement("div", {
    className: prefix('group-actions'),
    key: "group-actions"
  }, React.createElement("div", {
    className: prefix('group-action-delete'),
    onClick: deleteIt
  }), index !== 0 && React.createElement("div", {
    className: prefix('group-action-move-up'),
    onClick: () => moveIt(-1)
  }), index !== IDList.length - 1 && React.createElement("div", {
    className: prefix('group-action-move-down'),
    onClick: () => moveIt(1)
  }), index !== 0 && React.createElement("div", {
    className: prefix('group-action-move-to-first'),
    onClick: () => moveIt(-Infinity)
  }), index !== IDList.length - 1 && React.createElement("div", {
    className: prefix('group-action-move-to-last'),
    onClick: () => moveIt(Infinity)
  }))];
};
export const groupsAPI = (_ref11) => {
  let groups = _ref11.groups,
      render = _ref11.render,
      setID = _ref11.setID,
      getID = _ref11.getID;
  return mapObject(groups, (formName, groupValue) => {
    const Com = groupValue.Com,
          field = groupValue.field,
          needDrag = groupValue.needDrag,
          IDRefMap = groupValue.IDRefMap,
          IDList = groupValue.IDList,
          Form = groupValue.Form,
          _groupValue$formProps = groupValue.formProps,
          formProps = _groupValue$formProps === void 0 ? {} : _groupValue$formProps;

    const addItem = function addItem() {
      let add = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : dinoFormAddItem;
      return add({
        getGroup: () => groupValue,
        setID,
        getID,
        render
      });
    };

    const deleteItem = function deleteItem(ID) {
      let deleteItemFun = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : dinoFormDeleteItem;
      return deleteItemFun({
        ID,
        getGroup: () => groupValue,
        setID,
        getID,
        render
      });
    };

    const moveItem = function moveItem(ID, offset) {
      let move = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : dinoFormMoveItem;
      return move({
        ID,
        offset,
        getGroup: () => groupValue,
        setID,
        getID,
        render
      });
    };

    const doAction = fun => fun({
      getGroup: () => groupValue,
      setID,
      getID,
      render
    });

    const mapFun = (mapGroup, ID, index) => mapGroup({
      ID,
      index: +index,
      Com,
      field,
      IDRefMap,
      IDList,
      Form: {
        FormCom: Form,
        formProps: _objectSpread({}, formProps, (groups[formName].IDRefMap[ID] || {}).props || {}, {
          ID
        })
      },
      deleteIt: () => deleteItem(ID),
      moveIt: offset => moveItem(ID, offset),
      formProps
    });

    const group = {
      IDList,
      dragMap: function dragMap() {
        let mapGroup = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : dinoFormMapGroup;
        return IDList.length > 0 ? React.createElement(Drag, {
          order: [...IDList],
          lastActionMoveID: groupValue.lastActionMoveID,
          lastMoveID: groupValue.lastMoveID,
          changeDone: newIDList => {
            groupValue.IDList = [...newIDList];
            render();
          }
        }, mapObject(IDList, (index, ID) => ({
          [ID]: mapFun(mapGroup, ID, index)
        }))) : null;
      },
      map: function map() {
        let mapGroup = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : dinoFormMapGroup;
        return IDList.length > 0 ? React.createElement("div", {
          className: `${prefix('map-container')}`
        }, IDList.map((ID, index) => React.createElement("div", {
          className: `${prefix('group-item-wrap')}`,
          key: ID
        }, mapFun(mapGroup, ID, index)))) : null;
      },
      render: function render() {
        let renderGroup = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : ele => React.createElement("div", {
          className: `${prefix('group')}`
        }, React.createElement("div", {
          className: `${prefix('group-ele')}`
        }, ele), React.createElement("div", {
          className: prefix('group-action-add'),
          onClick: () => addItem()
        }));
        let children = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : needDrag ? group.dragMap() : group.map();
        return React.createElement("div", {
          className: `${prefix('group-wrap')}`
        }, renderGroup(children));
      },
      addItem,
      deleteItem,
      moveItem,
      doAction
    };
    return {
      [formName]: group
    };
  });
};
export const subFormsAPI = function subFormsAPI() {
  let _ref12 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
      subForms = _ref12.subForms;

  return mapObject(subForms, (formName, _ref13) => {
    let Form = _ref13.Form;
    return {
      [formName]: Form
    };
  });
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9EaW5vRm9ybUhlbHBlci5qc3giXSwibmFtZXMiOlsiUmVhY3QiLCJDb21wb25lbnQiLCJwcmVmaXgiLCJtYXBPYmplY3QiLCJEaW5vRm9ybUl0ZW0iLCJEcmFnIiwiZGlub0Zvcm1HZXRHcm91cFJlZiIsImdyb3VwIiwiaW5kZXgiLCJJRCIsInJlbmRlciIsIklEUmVmTWFwIiwiSURMaXN0IiwiZm9ybU5hbWUiLCJyZWYiLCJyZVRyeVJlZkNvdW50IiwiY3JlYXRlRnJhZ21lbnRzIiwiZnJhZ21lbnRzIiwiY3JlYXRlRGlub0Zvcm1BcGkiLCJjb21OYW1lIiwiQ29tIiwicHJvcHMiLCJGcmFnbWVudCIsImNyZWF0ZUZyb21JdGVtIiwiRGlub0Zvcm1JdGVtV3JhcCIsImNyZWF0ZURpbm9Gb3JtR3JvdXBXcmFwIiwic2V0SURSZWZNYXAiLCJ0b3BGb3JtUmVuZGVyIiwiRGlub0Zvcm1XcmFwIiwiY29uc3RydWN0b3IiLCJjYXRjaFJlZiIsInVuZGVmaW5lZCIsImNvbXBvbmVudERpZE1vdW50IiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJjcmVhdGVEaW5vRm9ybVN1YkZvcm0iLCJzdWJGb3JtcyIsImZvcm0iLCJGb3JtIiwiZmllbGQiLCJmb3JtUHJvcHMiLCJzdWJGb3JtIiwiRGlub1N1YkZvcm0iLCJkaW5vRm9ybUFkZEl0ZW0iLCJnZXRHcm91cCIsInNldElEIiwiZ2V0SUQiLCJwdXNoIiwiZGlub0Zvcm1EZWxldGVJdGVtIiwiZGVsZXRlSUQiLCJmaWx0ZXIiLCJkaW5vRm9ybU1vdmVJdGVtIiwib2Zmc2V0IiwiaW5kZXhPZiIsImxhc3RBY3Rpb25Nb3ZlSUQiLCJJbmZpbml0eSIsImxhc3RNb3ZlSUQiLCJzcGxpY2UiLCJsZW5ndGgiLCJkaW5vRm9ybU1hcEdyb3VwIiwiRm9ybUNvbSIsImRlbGV0ZUl0IiwibW92ZUl0IiwiZ3JvdXBzQVBJIiwiZ3JvdXBzIiwiZ3JvdXBWYWx1ZSIsIm5lZWREcmFnIiwiYWRkSXRlbSIsImFkZCIsImRlbGV0ZUl0ZW0iLCJkZWxldGVJdGVtRnVuIiwibW92ZUl0ZW0iLCJtb3ZlIiwiZG9BY3Rpb24iLCJmdW4iLCJtYXBGdW4iLCJtYXBHcm91cCIsImRyYWdNYXAiLCJuZXdJRExpc3QiLCJtYXAiLCJyZW5kZXJHcm91cCIsImVsZSIsImNoaWxkcmVuIiwic3ViRm9ybXNBUEkiXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBT0EsS0FBUCxJQUFnQkMsU0FBaEIsUUFBaUMsT0FBakM7QUFDQSxTQUFTQyxNQUFULEVBQWlCQyxTQUFqQixRQUFrQyxRQUFsQztBQUNBLE9BQU9DLFlBQVAsTUFBeUIsZ0JBQXpCO0FBQ0EsT0FBT0MsSUFBUCxNQUFpQixRQUFqQjtBQUVBLE9BQU8sTUFBTUMsbUJBQW1CLEdBQUcsZUFBdEJBLG1CQUFzQixHQUE2QztBQUFBLGlGQUFQLEVBQU87QUFBQSxNQUFwQ0MsS0FBb0MsUUFBcENBLEtBQW9DO0FBQUEsTUFBN0JDLEtBQTZCLFFBQTdCQSxLQUE2QjtBQUFBLE1BQXRCQyxFQUFzQixRQUF0QkEsRUFBc0I7QUFBQSxNQUFsQkMsTUFBa0IsUUFBbEJBLE1BQWtCOztBQUFBLFFBQ3RFQyxRQURzRSxHQUN2Q0osS0FEdUMsQ0FDdEVJLFFBRHNFO0FBQUEsUUFDNURDLE1BRDRELEdBQ3ZDTCxLQUR1QyxDQUM1REssTUFENEQ7QUFBQSxRQUNwREMsUUFEb0QsR0FDdkNOLEtBRHVDLENBQ3BETSxRQURvRDtBQUFBLHFCQU8xRUYsUUFQMEUsQ0FJM0VGLEVBSjJFO0FBQUEsMkNBTXhFLEVBTndFO0FBQUEsTUFLMUVLLEdBTDBFLGdCQUsxRUEsR0FMMEUsRUFROUU7O0FBUjhFLFVBU3RELENBVHNEO0FBQUEsTUFTeEVDLGFBVHdFLEtBU3hFQSxhQVR3RTs7QUFXOUUsU0FBTyxDQUFDRCxHQUFELElBQVFDLGFBQWEsS0FBSyxDQUFqQyxFQUFvQztBQUNsQyxVQUFNTCxNQUFNLEVBQVo7QUFEa0Msd0JBTTlCQyxRQU44QixDQUcvQkYsRUFIK0I7QUFBQSwrQ0FLNUIsRUFMNEI7QUFJOUJL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QUN0QixRQUFEO0FBQUEsUUFBYXdCLElBQWIsVUFBYUEsSUFBYjtBQUFBLFdBQXlCO0FBQzdGLE9BQUN4QixRQUFELEdBQVl3QjtBQURpRixLQUF6QjtBQUFBLEdBQVgsQ0FBaEM7QUFBQSxDQUFwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBwcmVmaXgsIG1hcE9iamVjdCB9IGZyb20gJy4vdXRpbCc7XG5pbXBvcnQgRGlub0Zvcm1JdGVtIGZyb20gJy4vRGlub0Zvcm1JdGVtJztcbmltcG9ydCBEcmFnIGZyb20gJy4vRHJhZyc7XG5cbmV4cG9ydCBjb25zdCBkaW5vRm9ybUdldEdyb3VwUmVmID0gYXN5bmMgKHsgZ3JvdXAsIGluZGV4LCBJRCwgcmVuZGVyIH0gPSB7fSkgPT4ge1xuICBjb25zdCB7IElEUmVmTWFwLCBJRExpc3QsIGZvcm1OYW1lIH0gPSBncm91cDtcblxuICBsZXQge1xuICAgIFtJRF06IHtcbiAgICAgIHJlZixcbiAgICB9ID0ge30sXG4gIH0gPSBJRFJlZk1hcDtcbiAgLy8gY29uc3RcbiAgbGV0IHsgcmVUcnlSZWZDb3VudCB9ID0gMztcblxuICB3aGlsZSAoIXJlZiAmJiByZVRyeVJlZkNvdW50LS0gPiAwKSB7XG4gICAgYXdhaXQgcmVuZGVyKCk7XG4gICAgKHtcbiAgICAgIFtJRF06IHtcbiAgICAgICAgcmVmLFxuICAgICAgfSA9IHt9LFxuICAgIH0gPSBJRFJlZk1hcCk7XG4gIH1cblxuICByZXR1cm4gcmVmO1xufTtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUZyYWdtZW50cyA9ICh7IGZyYWdtZW50cywgY3JlYXRlRGlub0Zvcm1BcGkgfSkgPT4gKFxuICBtYXBPYmplY3QoZnJhZ21lbnRzLCAoY29tTmFtZSwgeyBDb20sIC4uLnByb3BzIH0gPSB7fSkgPT4gKHtcbiAgICBbY29tTmFtZV06IE9iamVjdC5hc3NpZ24oXG4gICAgICBjbGFzcyBGcmFnbWVudCBleHRlbmRzIENvbXBvbmVudCB7XG4gICAgICAgIHJlbmRlcigpIHtcbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPENvbVxuICAgICAgICAgICAgICBkaW5vRm9ybT17IGNyZWF0ZURpbm9Gb3JtQXBpKCkgfVxuICAgICAgICAgICAgICB7IC4uLnByb3BzIH1cbiAgICAgICAgICAgICAgeyAuLi4odGhpcy5wcm9wcyB8fCB7fSkgfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBwcm9wcyxcbiAgICApLFxuICB9KSlcbik7XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVGcm9tSXRlbSA9ICh7IGNyZWF0ZURpbm9Gb3JtQXBpIH0pID0+IChcbiAgY2xhc3MgRGlub0Zvcm1JdGVtV3JhcCBleHRlbmRzIENvbXBvbmVudCB7XG4gICAgcmVuZGVyKCkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPERpbm9Gb3JtSXRlbVxuICAgICAgICAgIGRpbm9Gb3JtPXsgY3JlYXRlRGlub0Zvcm1BcGkoKSB9XG4gICAgICAgICAgeyAuLi4odGhpcy5wcm9wcyB8fCB7fSkgfVxuICAgICAgICAgIC8+XG4gICAgICApO1xuICAgIH1cbiAgfVxuKTtcblxuXG5leHBvcnQgY29uc3QgY3JlYXRlRGlub0Zvcm1Hcm91cFdyYXAgPSAoe1xuICBzZXRJRFJlZk1hcCwgQ29tLCB0b3BGb3JtUmVuZGVyLFxufSkgPT4gKFxuICBjbGFzcyBEaW5vRm9ybVdyYXAgZXh0ZW5kcyBDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgICBzdXBlcihwcm9wcyk7XG4gICAgICB0aGlzLkNvbSA9IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgIGNvbnN0IHsgSUQsIGluZGV4IH0gPSB0aGlzLnByb3BzO1xuICAgICAgc2V0SURSZWZNYXAoSUQsIHsgcmVmOiB0aGlzLkNvbSB9KTtcbiAgICB9XG5cbiAgICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgIGNvbnN0IHsgSUQsIGluZGV4IH0gPSB0aGlzLnByb3BzO1xuICAgICAgc2V0SURSZWZNYXAoSUQsIHsgcmVmOiB1bmRlZmluZWQgfSk7XG4gICAgfVxuXG4gICAgY2F0Y2hSZWYgPSAocmVmKSA9PiB7XG4gICAgICBjb25zdCB7IElELCBjYXRjaFJlZiA9ICgpID0+IHt9IH0gPSB0aGlzLnByb3BzO1xuICAgICAgdGhpcy5Db20gPSByZWY7XG4gICAgICBjYXRjaFJlZihyZWYpO1xuICAgIH1cblxuICAgIHJlbmRlcigpIHtcbiAgICAgIGNvbnN0IHsgSUQsIGluZGV4IH0gPSB0aGlzLnByb3BzO1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPENvbVxuICAgICAgICAgIElEPXsgSUQgfVxuICAgICAgICAgIGluZGV4PXsgaW5kZXggfVxuICAgICAgICAgIHJlZj17IHRoaXMuY2F0Y2hSZWYgfVxuICAgICAgICAgIHRvcEZvcm1SZW5kZXI9eyB0b3BGb3JtUmVuZGVyIH1cbiAgICAgICAgICBzdWJHcm91cEZvcm1cbiAgICAgICAgICAvPlxuICAgICAgKTtcbiAgICB9XG4gIH1cbik7XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVEaW5vRm9ybVN1YkZvcm0gPSBzdWJGb3JtcyA9PiAoXG4gIG1hcE9iamVjdChzdWJGb3JtcywgKGZvcm1OYW1lLCBmb3JtKSA9PiB7XG4gICAgY29uc3QgeyBGb3JtLCBmaWVsZCwgZm9ybVByb3BzID0ge30gfSA9IGZvcm07XG4gICAgY29uc3Qgc3ViRm9ybSA9IHtcbiAgICAgIGZpZWxkLFxuICAgICAgZm9ybVByb3BzLFxuICAgICAgcmVmOiB1bmRlZmluZWQsXG4gICAgICBGb3JtOiBjbGFzcyBEaW5vU3ViRm9ybSBleHRlbmRzIENvbXBvbmVudCB7XG4gICAgICAgIHJlbmRlcigpIHtcbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPEZvcm1cbiAgICAgICAgICAgICAgeyAuLi5mb3JtUHJvcHMgfVxuICAgICAgICAgICAgICB7IC4uLnRoaXMucHJvcHMgfVxuICAgICAgICAgICAgICByZWY9eyAocmVmKSA9PiB7IHN1YkZvcm0ucmVmID0gcmVmOyB9IH1cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgIH07XG4gICAgcmV0dXJuIHtcbiAgICAgIFtmb3JtTmFtZV06IHN1YkZvcm0sXG4gICAgfTtcbiAgfSlcbik7XG5cblxuZXhwb3J0IGNvbnN0IGRpbm9Gb3JtQWRkSXRlbSA9ICh7XG4gIGdldEdyb3VwLFxuICBzZXRJRCxcbiAgZ2V0SUQsXG4gIHJlbmRlcixcbn0pID0+IHtcbiAgY29uc3QgSUQgPSBnZXRJRCgpO1xuICBnZXRHcm91cCgpLklETGlzdC5wdXNoKElEKTtcbiAgc2V0SUQoSUQgKyAxKTtcbiAgcmVuZGVyKCk7XG4gIHJldHVybiBJRDtcbn07XG5cbmV4cG9ydCBjb25zdCBkaW5vRm9ybURlbGV0ZUl0ZW0gPSAoeyBJRDogZGVsZXRlSUQsIGdldEdyb3VwLCByZW5kZXIgfSkgPT4ge1xuICBjb25zdCBncm91cCA9IGdldEdyb3VwKCk7XG4gIGdyb3VwLklETGlzdCA9IGdyb3VwLklETGlzdC5maWx0ZXIoSUQgPT4gSUQgIT09IGRlbGV0ZUlEKTtcbiAgcmVuZGVyKCk7XG59O1xuXG5leHBvcnQgY29uc3QgZGlub0Zvcm1Nb3ZlSXRlbSA9ICh7XG4gIElELCBvZmZzZXQsIGdldEdyb3VwLCByZW5kZXIsXG59KSA9PiB7XG4gIGNvbnN0IGdyb3VwID0gZ2V0R3JvdXAoKTtcbiAgY29uc3QgaW5kZXggPSBncm91cC5JRExpc3QuaW5kZXhPZihJRCk7XG4gIGdyb3VwLmxhc3RBY3Rpb25Nb3ZlSUQgPSBJRDtcblxuICBpZiAob2Zmc2V0ID09PSAtSW5maW5pdHkpIHtcbiAgICBncm91cC5sYXN0TW92ZUlEID0gZ3JvdXAuSURMaXN0WzBdO1xuICAgIGdyb3VwLklETGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIGdyb3VwLklETGlzdC5zcGxpY2UoMCwgMCwgSUQpO1xuICB9IGVsc2UgaWYgKG9mZnNldCA9PT0gSW5maW5pdHkpIHtcbiAgICBncm91cC5sYXN0TW92ZUlEID0gZ3JvdXAuSURMaXN0W2dyb3VwLklETGlzdC5sZW5ndGggLSAxXTtcbiAgICBncm91cC5JRExpc3Quc3BsaWNlKGluZGV4LCAxKTtcbiAgICBncm91cC5JRExpc3Quc3BsaWNlKGdyb3VwLklETGlzdC5sZW5ndGgsIDAsIElEKTtcbiAgfSBlbHNlIHtcbiAgICBncm91cC5sYXN0TW92ZUlEID0gZ3JvdXAuSURMaXN0W2luZGV4ICsgb2Zmc2V0XTtcbiAgICBncm91cC5JRExpc3Quc3BsaWNlKGluZGV4LCAxKTtcbiAgICBncm91cC5JRExpc3Quc3BsaWNlKGluZGV4ICsgb2Zmc2V0LCAwLCBJRCk7XG4gIH1cblxuICByZW5kZXIoKTtcbn07XG5cblxuZXhwb3J0IGNvbnN0IGRpbm9Gb3JtTWFwR3JvdXAgPSAoe1xuICBGb3JtOiB7XG4gICAgRm9ybUNvbSxcbiAgICBmb3JtUHJvcHMsXG4gIH0sXG4gIElELFxuICBJRExpc3QsXG4gIGluZGV4LFxuICBkZWxldGVJdCxcbiAgbW92ZUl0LFxufSkgPT4gKFtcbiAgPEZvcm1Db20geyAuLi5mb3JtUHJvcHMgfSBrZXk9eyBJRCB9IC8+LFxuICA8ZGl2IGNsYXNzTmFtZT17IHByZWZpeCgnZ3JvdXAtYWN0aW9ucycpIH0ga2V5PVwiZ3JvdXAtYWN0aW9uc1wiPlxuICAgIDxkaXYgY2xhc3NOYW1lPXsgcHJlZml4KCdncm91cC1hY3Rpb24tZGVsZXRlJykgfSBvbkNsaWNrPXsgZGVsZXRlSXQgfSAvPlxuICAgIHtcbiAgICAgIGluZGV4ICE9PSAwXG4gICAgICAmJiAoXG4gICAgICAgIDxkaXZcbiAgICAgICAgICBjbGFzc05hbWU9eyBwcmVmaXgoJ2dyb3VwLWFjdGlvbi1tb3ZlLXVwJykgfVxuICAgICAgICAgIG9uQ2xpY2s9eyAoKSA9PiBtb3ZlSXQoLTEpIH1cbiAgICAgICAgICAvPlxuICAgICAgKVxuICAgIH1cbiAgICB7XG4gICAgICBpbmRleCAhPT0gSURMaXN0Lmxlbmd0aCAtIDFcbiAgICAgICYmIChcbiAgICAgICAgPGRpdlxuICAgICAgICAgIGNsYXNzTmFtZT17IHByZWZpeCgnZ3JvdXAtYWN0aW9uLW1vdmUtZG93bicpIH1cbiAgICAgICAgICBvbkNsaWNrPXsgKCkgPT4gbW92ZUl0KDEpIH1cbiAgICAgICAgICAvPlxuICAgICAgKVxuICAgIH1cbiAgICB7XG4gICAgICBpbmRleCAhPT0gMFxuICAgICAgJiYgKFxuICAgICAgICA8ZGl2XG4gICAgICAgICAgY2xhc3NOYW1lPXsgcHJlZml4KCdncm91cC1hY3Rpb24tbW92ZS10by1maXJzdCcpIH1cbiAgICAgICAgICBvbkNsaWNrPXsgKCkgPT4gbW92ZUl0KC1JbmZpbml0eSkgfVxuICAgICAgICAgIC8+XG4gICAgICApXG4gICAgfVxuICAgIHtcbiAgICAgIGluZGV4ICE9PSBJRExpc3QubGVuZ3RoIC0gMVxuICAgICAgJiYgKFxuICAgICAgICA8ZGl2XG4gICAgICAgICAgY2xhc3NOYW1lPXsgcHJlZml4KCdncm91cC1hY3Rpb24tbW92ZS10by1sYXN0JykgfVxuICAgICAgICAgIG9uQ2xpY2s9eyAoKSA9PiBtb3ZlSXQoSW5maW5pdHkpIH1cbiAgICAgICAgICAvPlxuICAgICAgKVxuICAgIH1cbiAgPC9kaXY+LFxuXSk7XG5cbmV4cG9ydCBjb25zdCBncm91cHNBUEkgPSAoe1xuICBncm91cHMsXG4gIHJlbmRlcixcbiAgc2V0SUQsXG4gIGdldElELFxufSkgPT4gbWFwT2JqZWN0KGdyb3VwcywgKGZvcm1OYW1lLCBncm91cFZhbHVlKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBDb20sXG4gICAgZmllbGQsXG4gICAgbmVlZERyYWcsXG4gICAgSURSZWZNYXAsXG4gICAgSURMaXN0LFxuICAgIEZvcm0sXG4gICAgZm9ybVByb3BzID0ge30sXG4gIH0gPSBncm91cFZhbHVlO1xuXG4gIGNvbnN0IGFkZEl0ZW0gPSAoXG4gICAgYWRkID0gZGlub0Zvcm1BZGRJdGVtLFxuICApID0+IGFkZCh7XG4gICAgZ2V0R3JvdXA6ICgpID0+IGdyb3VwVmFsdWUsXG4gICAgc2V0SUQsXG4gICAgZ2V0SUQsXG4gICAgcmVuZGVyLFxuICB9KTtcblxuICBjb25zdCBkZWxldGVJdGVtID0gKFxuICAgIElELFxuICAgIGRlbGV0ZUl0ZW1GdW4gPSBkaW5vRm9ybURlbGV0ZUl0ZW0sXG4gICkgPT4gZGVsZXRlSXRlbUZ1bih7XG4gICAgSUQsXG4gICAgZ2V0R3JvdXA6ICgpID0+IGdyb3VwVmFsdWUsXG4gICAgc2V0SUQsXG4gICAgZ2V0SUQsXG4gICAgcmVuZGVyLFxuICB9KTtcblxuICBjb25zdCBtb3ZlSXRlbSA9IChcbiAgICBJRCxcbiAgICBvZmZzZXQsXG4gICAgbW92ZSA9IGRpbm9Gb3JtTW92ZUl0ZW0sXG4gICkgPT4gbW92ZSh7XG4gICAgSUQsXG4gICAgb2Zmc2V0LFxuICAgIGdldEdyb3VwOiAoKSA9PiBncm91cFZhbHVlLFxuICAgIHNldElELFxuICAgIGdldElELFxuICAgIHJlbmRlcixcbiAgfSk7XG5cbiAgY29uc3QgZG9BY3Rpb24gPSBmdW4gPT4gZnVuKHtcbiAgICBnZXRHcm91cDogKCkgPT4gZ3JvdXBWYWx1ZSxcbiAgICBzZXRJRCxcbiAgICBnZXRJRCxcbiAgICByZW5kZXIsXG4gIH0pO1xuXG4gIGNvbnN0IG1hcEZ1biA9IChtYXBHcm91cCwgSUQsIGluZGV4KSA9PiAoXG4gICAgbWFwR3JvdXAoe1xuICAgICAgSUQsXG4gICAgICBpbmRleDogK2luZGV4LFxuICAgICAgQ29tLFxuICAgICAgZmllbGQsXG4gICAgICBJRFJlZk1hcCxcbiAgICAgIElETGlzdCxcbiAgICAgIEZvcm06IHtcbiAgICAgICAgRm9ybUNvbTogRm9ybSxcbiAgICAgICAgZm9ybVByb3BzOiB7XG4gICAgICAgICAgLi4uZm9ybVByb3BzLFxuICAgICAgICAgIC4uLigoZ3JvdXBzW2Zvcm1OYW1lXS5JRFJlZk1hcFtJRF0gfHwge30pLnByb3BzIHx8IHt9KSxcbiAgICAgICAgICBJRCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBkZWxldGVJdDogKCkgPT4gZGVsZXRlSXRlbShJRCksXG4gICAgICBtb3ZlSXQ6IG9mZnNldCA9PiBtb3ZlSXRlbShJRCwgb2Zmc2V0KSxcbiAgICAgIGZvcm1Qcm9wcyxcbiAgICB9KVxuICApO1xuXG4gIGNvbnN0IGdyb3VwID0ge1xuICAgIElETGlzdCxcbiAgICBkcmFnTWFwOiAobWFwR3JvdXAgPSBkaW5vRm9ybU1hcEdyb3VwKSA9PiAoXG4gICAgICBJRExpc3QubGVuZ3RoID4gMFxuICAgICAgICA/IChcbiAgICAgICAgICA8RHJhZ1xuICAgICAgICAgICAgb3JkZXI9eyBbLi4uSURMaXN0XSB9XG4gICAgICAgICAgICBsYXN0QWN0aW9uTW92ZUlEPXsgZ3JvdXBWYWx1ZS5sYXN0QWN0aW9uTW92ZUlEIH1cbiAgICAgICAgICAgIGxhc3RNb3ZlSUQ9eyBncm91cFZhbHVlLmxhc3RNb3ZlSUQgfVxuICAgICAgICAgICAgY2hhbmdlRG9uZT17IChuZXdJRExpc3QpID0+IHtcbiAgICAgICAgICAgICAgZ3JvdXBWYWx1ZS5JRExpc3QgPSBbLi4ubmV3SURMaXN0XTsgcmVuZGVyKCk7XG4gICAgICAgICAgICB9IH0+XG4gICAgICAgICAgICB7XG4gICAgICAgICAgbWFwT2JqZWN0KElETGlzdCwgKGluZGV4LCBJRCkgPT4gKHsgW0lEXTogbWFwRnVuKG1hcEdyb3VwLCBJRCwgaW5kZXgpIH0pKVxuICAgICAgICB9XG4gICAgICAgICAgPC9EcmFnPlxuICAgICAgICApIDogbnVsbFxuICAgICksXG4gICAgbWFwOiAobWFwR3JvdXAgPSBkaW5vRm9ybU1hcEdyb3VwKSA9PiAoXG4gICAgICBJRExpc3QubGVuZ3RoID4gMFxuICAgICAgICA/IChcbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17IGAke3ByZWZpeCgnbWFwLWNvbnRhaW5lcicpfWAgfT5cbiAgICAgICAgICAgIHtcbiAgICAgICAgICBJRExpc3QubWFwKChJRCwgaW5kZXgpID0+IChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXsgYCR7cHJlZml4KCdncm91cC1pdGVtLXdyYXAnKX1gIH0ga2V5PXsgSUQgfT5cbiAgICAgICAgICAgICAgeyBtYXBGdW4obWFwR3JvdXAsIElELCBpbmRleCl9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICApKVxuICAgICAgICB9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICkgOiBudWxsXG4gICAgKSxcbiAgICByZW5kZXI6IChcbiAgICAgIHJlbmRlckdyb3VwID0gZWxlID0+IChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9eyBgJHtwcmVmaXgoJ2dyb3VwJyl9YCB9PlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXsgYCR7cHJlZml4KCdncm91cC1lbGUnKX1gIH0+XG4gICAgICAgICAgICB7ZWxlfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgIGNsYXNzTmFtZT17IHByZWZpeCgnZ3JvdXAtYWN0aW9uLWFkZCcpIH1cbiAgICAgICAgICAgIG9uQ2xpY2s9eyAoKSA9PiBhZGRJdGVtKCkgfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgPC9kaXY+XG4gICAgICApLFxuICAgICAgLy8gY2hpbGRyZW4gPSAobmVlZERyYXAgPyBncm91cC5kcmFnTWFwKCkgOiBncm91cC5tYXAoKSksXG4gICAgICBjaGlsZHJlbiA9IChuZWVkRHJhZyA/IGdyb3VwLmRyYWdNYXAoKSA6IGdyb3VwLm1hcCgpKSxcbiAgICApID0+IChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPXsgYCR7cHJlZml4KCdncm91cC13cmFwJyl9YCB9PlxuICAgICAgICB7cmVuZGVyR3JvdXAoY2hpbGRyZW4pfVxuICAgICAgPC9kaXY+XG4gICAgKSxcbiAgICBhZGRJdGVtLFxuICAgIGRlbGV0ZUl0ZW0sXG4gICAgbW92ZUl0ZW0sXG4gICAgZG9BY3Rpb24sXG4gIH07XG5cbiAgcmV0dXJuIHsgW2Zvcm1OYW1lXTogZ3JvdXAgfTtcbn0pO1xuXG5leHBvcnQgY29uc3Qgc3ViRm9ybXNBUEkgPSAoeyBzdWJGb3JtcyB9ID0ge30pID0+IG1hcE9iamVjdChzdWJGb3JtcywgKGZvcm1OYW1lLCB7IEZvcm0gfSkgPT4gKHtcbiAgW2Zvcm1OYW1lXTogRm9ybSxcbn0pKTtcbiJdfQ==